# Configuration Apache pour Franck Bot + Présentation
# À placer dans /etc/apache2/sites-available/franck.blis.im.conf
# Puis activer: sudo a2ensite franck.blis.im.conf && sudo systemctl reload apache2

<VirtualHost *:443>
    ServerName franck.blis.im

    # SSL Configuration
    SSLEngine on
    SSLCertificateFile /etc/letsencrypt/live/franck.blis.im/fullchain.pem
    SSLCertificateKeyFile /etc/letsencrypt/live/franck.blis.im/privkey.pem

    # Logs
    ErrorLog ${APACHE_LOG_DIR}/franck-error.log
    CustomLog ${APACHE_LOG_DIR}/franck-access.log combined

    # Servir la présentation HTML statique
    Alias /presentation /home/user/MAEL.IA/presentation.html
    <Location /presentation>
        Require all granted
        Header set Content-Type "text/html"
        Header set Cache-Control "public, max-age=3600"
    </Location>

    # Servir d'autres fichiers statiques si nécessaire
    Alias /static /home/user/MAEL.IA/static
    <Directory /home/user/MAEL.IA/static>
        Require all granted
        Header set Cache-Control "public, max-age=86400"
    </Directory>

    # Proxy vers l'application Flask/Gunicorn sur localhost:5000
    ProxyPreserveHost On
    ProxyTimeout 120

    # Ne pas proxyfier les fichiers statiques
    ProxyPass /presentation !
    ProxyPass /static !

    # Proxyfier tout le reste vers Flask
    ProxyPass / http://127.0.0.1:5000/
    ProxyPassReverse / http://127.0.0.1:5000/

    # Headers pour le proxy
    RequestHeader set X-Forwarded-Proto "https"
    RequestHeader set X-Forwarded-Port "443"
</VirtualHost>

# Redirection HTTP → HTTPS
<VirtualHost *:80>
    ServerName franck.blis.im

    RewriteEngine On
    RewriteCond %{HTTPS} off
    RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]
</VirtualHost>
